<!DOCTYPE html>
<html lang="en-us">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    
    <link rel="canonical" href="/posts/ms-rpc/">
    
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.154.5">

    
    
    

<title>Understanding MS-RPC and its Role in Windows Exploitation Tools ‚Ä¢ HaydnProcess</title>



  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Understanding MS-RPC and its Role in Windows Exploitation Tools">
  <meta name="twitter:description" content="A practical overview of MS-RPC, port 135, and how Windows administration and exploitation tools use it">

<meta property="og:url" content="/posts/ms-rpc/">
  <meta property="og:site_name" content="HaydnProcess">
  <meta property="og:title" content="Understanding MS-RPC and its Role in Windows Exploitation Tools">
  <meta property="og:description" content="A practical overview of MS-RPC, port 135, and how Windows administration and exploitation tools use it">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2026-01-27T18:56:47+01:00">
    <meta property="article:modified_time" content="2026-01-27T18:56:47+01:00">
    <meta property="article:tag" content="Ms-Rpc">
    <meta property="article:tag" content="Wmi">
    <meta property="article:tag" content="Smb">


    






<link rel="stylesheet" href="/scss/triple-hyde.02335ce9ff6f61fd978321bda79f698610aae0a8bb29330e816bc8a807a627a5.css" integrity="sha256-AjNc6f9vYf2XgyG9p59phhCq4Ki7KTMOgWvIqAemJ6U=">


<link rel="stylesheet" href="/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58&#43;TzH3icCkSHGoJ&#43;ed7w=" media="print">



 
<link rel="stylesheet" href="/css/custom.css">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    
    

</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
  <span class="site__title">
    <a href="/">
    
      HaydnProcess
    
    </a>
  </span>
  
    
    
    
    <div class="author-image">
      <img src="/images/avatar.png" alt="Author Image" class="img--circle img--headshot element--center">
    </div>
    
  
  
  <p class="site__description">
     Security starts with understanding 
  </p>
</div>

    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">HaydnProcess</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/posts/">
						<span>Posts</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/categories/">
						<span>Categories</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/about/">
						<span>About</span>
					</a>
				</li>
			 
		
	</ul>
</div>

        <section class="social">
	
	
	
	<a href="https://github.com/haydnprocess" rel="me">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

  </span>

</a>
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
</section>

      </div>
    </div>
    


  </div>
</div>

        <div class="content container">
            
    
<article>
  <header>
    <h1>Understanding MS-RPC and its Role in Windows Exploitation Tools</h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> Jan 27, 2026
    
    
    
      
      
          in
          
          
              <a class="badge badge-category" href="/categories/windows">WINDOWS</a>
              
          
      
    
    
    
      
      
          <br/>
           <i class="fas fa-tags"></i>
          
          <a class="badge badge-tag" href="/tags/ms-rpc">ms-rpc</a>
           
      
          <a class="badge badge-tag" href="/tags/wmi">wmi</a>
           
      
          <a class="badge badge-tag" href="/tags/smb">smb</a>
          
      
    
    
    <br/>
    <i class="fas fa-clock"></i> 5 min read
</div>


  </header>
  
  
  <div class="post">
    <h2 id="introduction">Introduction</h2>
<p>During a port scan, we often see port 135 (MS-RPC) on Windows systems. Furthermore, we all know and use tools like WMI, <code>rpcclient</code>, or <code>smbexec</code>.</p>
<p><em>But did you know that the use of these tools would not be possible without this specific port?</em></p>
<p>In this article, we will provide a brief description of the MS-RPC protocol, then examine its two modes of operation: <u>RPC over TCP using dynamic ports</u>, and <u>RPC over SMB using Named Pipes</u>. We will illustrate these modes respectively with WMI and <code>rpcclient</code>.</p>
<h2 id="rpc-ms-rpc-and-the-role-of-port-135">RPC, MS-RPC, and the role of port 135</h2>
<p>In short, RPC (<em>Remote Procedure Call</em>) enables procedure calls based on a client-server model, whether locally (client and server on the same machine) or remotely. In other words, it allows a process (client) to invoke a function exposed by another process (server).</p>
<p>üí° MS-RPC is simply Microsoft&rsquo;s implementation of the RPC protocol.</p>
<p>On Windows, services such as <strong>WMI</strong> (<em>Windows Management Instrumentation</em>) or <strong>SCM</strong> (<em>Service Control Manager</em>) <span style="font-weight: bold; color:red">rely on RPC</span> to receive and process requests. Therefore, if RPC (implemented by the RPCSS service) is disabled, all these services can no longer function, either locally or remotely - in other words, it amounts to <strong>cutting the backbone of Windows communications</strong>.</p>
<p>For remote RPC communications (the local case, which is simpler, will also be covered), RPC (or MS-RPC) can use two types of transport:</p>
<ul>
<li><u>RPC over TCP with dynamic ports</u>: RPC communication is performed over TCP, the services being reachable through dynamically assigned ports;</li>
<li><u>RPC over SMB via Named Pipes</u>: RPC communication is encapsulated within SMB over port 445.</li>
</ul>
<p>Finally, another key component of remote RPC communications is the Endpoint Mapper (port 135), which acts as a directory by indicating on which port each RPC service is available.</p>
<h2 id="rpc-over-tcp-wmi-case">RPC over TCP (WMI case)</h2>
<p>Before studying remote communications, it is useful to examine how MS-RPC works locally (client and server on the same machine). This will be illustrated using WMI.</p>
<h3 id="local-communication-with-wmi">Local communication with WMI</h3>
<p>Performing a WMI query locally works as follows:</p>
<ol>
<li>The following command is executed to list running processes: <code>wmic process list brief</code><sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup></li>
<li><code>wmic.exe</code> acts as the client (<span style="font-weight: bold; color:red">P1</span>): it does not list the processes itself. It builds a request and sends it via RPC (<code>ncalrpc</code> for local communication).
<ul>
<li><code>ncalrpc</code> (<em>Named Computer Local RPC</em>) is the RPC transport used for local communications.</li>
</ul>
</li>
<li>The WMI service (hosted in <code>winmgmt.exe</code>, <span style="font-weight: bold; color:#4169E1">P2</span>) acts as the local server: it receives the RPC request, queries the system, and returns the process list.</li>
<li>The response is sent back through the RPC channel to the client (<code>wmic.exe</code>, <span style="font-weight: bold; color:red">P1</span>), which displays it.</li>
</ol>
<p>Thus, RPC can be seen as a standardized &ldquo;tunnel&rdquo; that hides the complexity of inter-process communication and provides a unified interface for processes to communicate, locally or remotely.</p>
<h3 id="remote-communication-with-wmi-and-port-135">Remote communication with WMI (and port 135)</h3>
<p>The process is the same. Using the same WMI command, <code>wmic.exe</code> acts as the client (<span style="font-weight: bold; color:red">P1</span>) and queries the WMI service hosted in <code>winmgmt.exe</code> (<span style="font-weight: bold; color:#4169E1">P2</span>): <code>wmic /node:TARGET_IP process list brief</code></p>
<ul>
<li>The difference is in the <span style="font-weight: bold; color:red">transport</span>: for remote communication, <code>ncacn_ip_tcp</code> is used, using port 135 for endpoint resolution.</li>
<li><u>Port 135</u> only acts as a <u>directory</u> (Endpoint Mapper):
<ol>
<li>When <span style="font-weight: bold; color:#4169E1">P2</span> (e.g. WMI) starts, it opens a dynamic port within the allowed RPC range (e.g. 49685).</li>
<li>The Endpoint Mapper (135) registers the association: &ldquo;WMI (<span style="font-weight: bold; color:#4169E1">P2</span>) ‚Üí port 49685&rdquo;.</li>
<li>When <span style="font-weight: bold; color:red">P1</span> wants to contact <span style="font-weight: bold; color:#4169E1">P2</span>, it first queries port 135, which returns the dynamic port;  <span style="font-weight: bold; color:red">P1</span> then opens an <code>ncacn_ip_tcp</code> connection to port 49685 and communicates directly with <span style="font-weight: bold; color:#4169E1">P2</span>.</li>
</ol>
</li>
</ul>
<img src="remote-comm-wmi.png" class="zoomable" alt="WMI remote communication">
<h2 id="rpc-over-smb-via-named-pipes-rpcclient">RPC over SMB via Named Pipes (rpcclient)</h2>
<p>Under Windows, many RPC services (such as LSARPC, NETLOGON, and <strong>SAMR</strong> studied here) do not listen on a dedicated TCP port (unlike WMI, which uses a dynamic port). Instead, communication is performed via Named Pipes and carried over SMB (port 445).</p>
<p>üí° Port 135 is still used for endpoint mapping, but instead of returning a dynamic port, it returns the name of a named pipe. As with WMI, when a service starts (LSA, SAM, Netlogon, etc.), it registers itself with the Endpoint Mapper (port 135) by providing its endpoint - for example, <code>\pipe\samr</code>.</p>
<p><u>Illustration</u>: using <code>rpcclient</code>, we can for example list users with the <code>enumdomusers</code> command, which involves the following steps:</p>
<ol>
<li><strong>Contact port 135</strong> to locate the SAMR service<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>.
<ul>
<li>Port 135 responds that the SAMR service is available through the named pipe <code>\pipe\samr</code>.</li>
</ul>
</li>
<li><strong>Open the named pipe</strong> over the SMB protocol (port 445), for example <code>\\Server\pipe\samr</code>.</li>
<li><strong>Send the RPC request <code>enumdomusers</code></strong> (RPC call <code>SamrEnumerateUsersInDomain</code>) to the SAMR service.
<ul>
<li>If the target is a Domain Controller (DC): SAMR service queries the Active Directory database (NTDS.dit).</li>
<li>If the target is a non-DC machine: SAMR queries the local SAM database (<code>C:\Windows\System32\config\SAM</code>).</li>
</ul>
</li>
<li><strong>The service then returns the list of users</strong> through the same SMB connection (port 445), which <code>rpcclient</code> displays.</li>
</ol>
<p>‚ùóAlthough the communication goes through SMB, it is not related to the file-sharing functionality: here, SMB is only used as a channel to transport RPC messages.</p>
<img src="remote-comm-rpcclient.png" class="zoomable" alt="RPC over SMB">
<p>Finally, for other <code>rpcclient</code> commands (e.g. <code>netsharenum</code> to list shares), other services will be called in the same way: opening a named pipe over SMB (e.g. <code>\pipe\srvsvc</code>) ‚Üí sending an RPC call (<code>NetrShareEnum</code>) ‚Üí response from the <code>srvsvc</code> service.</p>
<p>The same principle is also used by Impacket tools such as <code>secretsdump.py</code> or <code>psexec.py</code>, which rely on the same RPC-over-SMB mechanisms.</p>
<h2 id="conclusion">Conclusion</h2>
<p>In summary, under Windows, RPC is an important mechanism that allows processes and services to communicate locally or remotely. Depending on the case, these exchanges rely either on TCP with dynamic ports or on SMB via Named Pipes, with port 135 also playing a key role in endpoint resolution.</p>
<p>These concepts help us to better understand how administration and attack tools operate and interact with Windows services.</p>
<h2 id="resources">Resources</h2>
<ul>
<li><a href="https://www.pentestpad.com/port-exploit/port-49152-windows-rpc-dynamic-port-range">https://www.pentestpad.com/port-exploit/port-49152-windows-rpc-dynamic-port-range</a></li>
<li><a href="https://www.akamai.com/en/blog/security-research/msrpc-security-mechanisms">https://www.akamai.com/en/blog/security-research/msrpc-security-mechanisms</a></li>
<li><a href="https://rakhesh.com/windows/notes-on-wmi-ports-monitoring/">https://rakhesh.com/windows/notes-on-wmi-ports-monitoring/</a></li>
<li><a href="https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-rpce/7063c7bd-b48b-42e7-9154-3c2ec4113c0d">https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-rpce/7063c7bd-b48b-42e7-9154-3c2ec4113c0d</a></li>
<li><a href="https://www.samba.org/samba/docs/current/man-html/rpcclient.1.html">https://www.samba.org/samba/docs/current/man-html/rpcclient.1.html</a></li>
</ul>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>The <code>wmic</code> client is now deprecated (since 09/25) and replaced by PowerShell cmdlets. This does not change the underlying MS-RPC mechanism.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>SAMR (<em>Security Account Manager Remote Protocol</em>) is a service that provides access, locally or remotely, to the SAM database.&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
  </div>
  

<div class="navigation navigation-single">
    
    
    <a href="/posts/cache-poisoning-url-normalization/" class="navigation-next">
      <span class="navigation-tittle">Illustrating Cache Key Normalization in Web Cache Poisoning</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  

  
    


</article>


        </div>
        
    




    



	
	<script>
		document.addEventListener("DOMContentLoaded", function() {

		  const overlay = document.createElement("div");
		  overlay.id = "img-overlay";
		  overlay.innerHTML = "<img>";
		  document.body.appendChild(overlay);

		  const overlayImg = overlay.querySelector("img");

		  document.querySelectorAll("img.zoomable").forEach(img => {
			img.addEventListener("click", function() {
			  overlayImg.src = this.src;
			  overlay.style.display = "flex";
			});
		  });

		  overlay.addEventListener("click", function() {
			overlay.style.display = "none";
		  });

		});
	</script>
	
	<script>
		document.addEventListener("DOMContentLoaded", function() {
  		document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
    	cb.removeAttribute('disabled');
  			});
		});
	</script>
    </body>

</html>
